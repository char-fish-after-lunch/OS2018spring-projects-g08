RISC-V Privileged Architecture 1.9.1学习记录


# 中断/异常/系统调用

中断分为三类：
* 软件中断：`ip`中的`xSIP`位被软件置1
* 时钟中断：M-mode的由硬件置（？），其余由M-mode软件置1。（`xTIP`）
* 外部中断：同上（`xEIP`）

中断的使能
* 影响所有类型中断的使能：`status`中的`SIE`, `UIE`（还有`SPIE`, `UPIE`）
* 部分类型中断的使能：`SEIE`, `STIE`, `SSIE`, `UEIE`等

处理：
* 异常处理返回：`xret`指令，会从相应的栈中弹出数据，并且将`pc`指向`xepc`
* 中断向量：`xtvec`寄存器，支持两种标准的模式
    * 0：所有的异常都在`BASE`处理
    * 1：所有同步异常在`BASE`处理，所有异步异常（中断）在`BASE + 4 * cause`处处理
* 代理：`xedeleg`和`xideleg`可以将指定类型的中断代理给更低的一级模式进行处理（感觉有点像高级语言异常处理里把异常抛出的操作）


等待中断：`wfi`指令，告知CPU暂停内核线程等待中断。
